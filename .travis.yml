language: android
jdk:
- oraclejdk8
env:
  global:
  - NDK_VERSION=r12b
  - NDK_CCACHE=ccache
  - GOROOT_BOOTSTRAP=$GOROOT
  - ANDROID_NDK_HOME=$HOME/.android/android-ndk-${NDK_VERSION}
  - SBTPATH=$HOME/.sbt
  - PATH=${ANDROID_NDK_HOME}:${ANDROID_HOME}/tools:${ANDROID_HOME}/platform-tools:${PATH}
scala:
- 2.11.8
before_cache:
- find $HOME/.sbt -name "*.lock" | xargs rm
- find $HOME/.ivy2 -name "*.lock" | xargs rm
cache:
  directories:
  - $HOME/.ivy2
  - $HOME/.sbt
android:
  components:
  - tools
  - build-tools-25.0.1
  - extra-android-m2repository
  - extra-google-m2repository
install:
- |
  if [ ! -d "$ANDROID_NDK_HOME" ]; then
      mkdir -p $ANDROID_NDK_HOME;
      pushd $HOME/.android;
      export ARCH=`uname -m`;
      wget -q http://dl.google.com/android/repository/android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
      unzip -q android-ndk-${NDK_VERSION}-linux-${ARCH}.zip;
      popd;
  fi
- |
  if [ ! -f "$SBTPATH/sbt" ]; then
      pushd $SBTPATH;
      wget -q https://raw.githubusercontent.com/paulp/sbt-extras/master/sbt;
      chmod a+x sbt;
      popd;
  fi
script:
- $SBTPATH/sbt native-build android:package-debug
deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: fsTWEGUvycr9+/C762CEX7aSSc3HkXYyL/CcDrafhK5YTgnKJap+MR+JZ2WYUMXaRIyiVNRShRIpAGDdfSnfwCANP8x4L0/BINPuMWAaWzvhZLBn9lZUTSFIO3D0y/41pG1YrmaJPkyWI2+Dh0jvZgA3LncORH+v/HhiNZsWn3gFvoYjwuoHsUvdxE1xvYv7vbHaO2SmgiNRdFAphnNmn5B8G5ddSZiP7ZxsZR5hmd+BNlbQDU6pBDIEI1YefR0BMOiEXXfi71/R/DrNSxAnyqR+yGJIA4KK0Znrs/1eKo9zmFRbtrG008CWTCB5dszf8PP0M3thB4TC7BPVJz5NTK2f+kyQgLEX6x9FsJINtmjqbK2I4IBo4Y6RPMHSTTtkuvF5OkCktWkEI/YqjstHgSo5YJbcWEzS7vh5utbalKZTFfEGVUQEy4VnH/417Ka56BebgLbx7+UCrVPn4LoNLAEdnT70AAhAzkmQMG+HfMe4wxIh7pBItqs470bkBtfzzDh2b8iNjU+/QBkda/Qr1WtSrE+ui0Xs2vDX/nLY2bmNL0fsKMqSrRxcvPus+6Iqu+v8gtXhCmh0FvtZUfNoc/TOdjg3TFddjXt2MmE21VnOvL9QD/pAwf7lF36UVyJ9f0WUhG2qmDHTD7ZIGAxH6130Xh/5BgS3hu4LpR9NqRM=
  file: /home/travis/build/falseen/shadowsocks-android/target/android/output/shadowsocks-debug.apk
  on:
    repo: falseen/shadowsocks-android
    branch: python
    tags: true
